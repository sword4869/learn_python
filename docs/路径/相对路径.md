[toc]

---

[[toc]]

---
- [1. 相对路径](#1-相对路径)
  - [1.1. intro](#11-intro)
    - [1.1.1. 包、模块、库](#111-包模块库)
  - [1.2. 导入模块](#12-导入模块)
    - [1.2.1. main-module架构](#121-main-module架构)
      - [1.2.1.1. 正确：](#1211-正确)
      - [1.2.1.2. 错误：](#1212-错误)
    - [1.2.2. 模块化的方法](#122-模块化的方法)


---

# 1. 相对路径

## 1.1. intro
### 1.1.1. 包、模块、库

- 模块Module就是单个的py文件。

- 包Package是一个文件夹，其内包含多个模块，即包含多个py文件。

- 在python中，库Library就是在说包。

PS：在python3.3后，包内就不用创建个`__init__.py`文件来标识此为包了，标识为包的作用不用了。但是还有别的用处：package下多个module的导入。


```python
├── main.py
└── mod
    ├── mod1_main.py
    └── mod2_main.py
```

```python
# main.py

from mod import mod1_main   # 单个文件没有问题
# from mod import *   # 多个文件出错，什么都没有导入
```
这时候需要你创建`__init__.py`，内容是

```python
__all__ = ['a', 'b']
```
多个文件的导入就没问题了。

## 1.2. 导入模块

### 1.2.1. main-module架构
```bash
project
├── main.py
├── src
│   ├── mod1
│   │   └── mod1_main.py
│   └── mod2
│       └── mod2_main.py
├── mytest
│   └── a.py
└── data
    └── deepwater.jpg

main.py的意义是项目根目录的文件，如果加入别的类似main的文件，也得在项目根目录下。

module的意思是非项目根目录下，但其内的文件不能调用其他模块。比如，mytest/a.py不能调用mod1_main。
`from src.mod1.mod1_main import *`找不到`src`，`from ..src.mod2.mod2_main import show`不知道..表示的父包。

包：project, src, mod1, mod2
模块：main.py, mod1_main.py, mod2_main.py
```


- py文件：导入是`src.xxxx`
  ```bash
  # main.py，python执行的路径随意，src.xxx都是根据main.py的相对位置，所以都能找到。
  project$ python main.py
  home$ python FacePic/project/main.py

  # a.py去哪执行都执行不了，ModuleNotFoundError: No module named 'src'
  # project$ python mytest/a.py
  ```
  
  1. `python main.py`，对于`main.py`文件，导入其他包的相对路径是根据运行此命令的路径。


  2. `main.py`中引用的py文件，其被引用的py文件(`b.py`)内自己再导入其他包或模块的相对路径是，根据其被引用的py文件自身(`b.py`)的位置，而不是`xxx.py`的位置。

  3. 只有from导入package才能用相对路径，其他都只能使用绝对路径。
     - 一般用在同package下有多个module时，比如创个`mod1/mod1_another.py`，在`mod1_main.py`中可以`from . import mo1_another`
     - 但是不能导project根目录为包。ImportError: attempted relative import with no known parent package。
       
        比如`main.py`调用根木目下的`c.py`，`from . import c`是错的，`import c`是对的。
       
        再比如，创了个`mytest/a.py`，里面导入main，`from .. import main`是错的。

- 文件资源：
  
  > 这个python路径必须在project下`project$ python main.py`：
  
  - `img_path = '../deepwater.jpg'`。也必须是在project下
  
  - `img_path = 'data/deepwater.jpg'`，注意这也是相对于python执行路径的。
  
  > 执行路径随意：

  - 相对`mod2_main.py`
    ```python
    import os
    base_dir = os.path.abspath(os.path.join(__file__, '..', '..', '..'))
    img_path = os.path.join(base_dir, r'data\deepwater.jpg')
    ```
    `__file__`是`/home/FacePic/project/src/mod2/mod2_main.py`，要加三个。这个`base_dir`是项目根目录`/home/FacePic/project`

  - 相对`main.py`
    ```python
    import os
    import sys
    img_path = os.path.join(sys.argv[0], '..', r'data\deepwater.jpg')
    ```
    `sys.argv[0]`就是`main.py`的路径，`sys.argv[0], '..'`就是项目根目录。


#### 1.2.1.1. 正确：

`main.py`是调用`mod1_main.py`，`mod1_main.py`调用`mod12_main.py`内打开`deepwater.jpg`图片的函数。


> from

- 导入：`from <module> import <class/function/variable/*>`
  
  使用：`<class/function/variable/*>`

  <details>
  <summary>详情例子</summary>
  
  - `main.py`
    ```python
    from src.mod1.mod1_main import call # 只能绝对路径
    # from .src.mod1.mod1_main import call 报错，ImportError: attempted relative import with no known parent package

    call()
    ```
  - `mod1_main.py`
    ```python
    from src.mod2.mod2_main import show
    # from ..mod2.mod2_main import show

    def call():
        show()
    ```
  - `mod2_main.py`
    ```python
    from PIL import Image
    import os
    import sys
    

    def show():
        # 图片的引入
        img_path = os.path.join(sys.argv[0], '..', r'data\deepwater.jpg')
        img = Image.open(img_path)
        img.show()
    ```

  </details>
  
- 导入：`from <package> import <module>`
  
  使用：`<module>.<class/function/variable>`

  <details>
  <summary>详情例子</summary>

  - `mod1_main.py`
    ```python
    from src.mod2 import mod2_main
    # from ..mod2 import mod2_main

    def call():
        mod2_main.show()
    ```
  </details>


> import

- 导入：`import <module>`
  
  使用：`<module>.<class/function/variable>`

  <details>
  <summary>详情例子</summary>

  - `mod1_main.py`
    ```python
    import src.mod2.mod2_main as mod2_main
    # import ..mod2.mod2_main as mod2_main 不能使用相对路径，AttributeError: module 'src.mod2' has no attribute 'mod2_main'


    def call():
        mod2_main.show()
    ```
  </details>




#### 1.2.1.2. 错误：


> from

- 导入：`from <package> import <module>.<class/function/variable/*>`
  
  使用：`<class/function/variable/*>`
  
  <details>
  <summary>详情例子</summary>

  - `mod1_main.py`
    ```python
    # from ..mod2 import mod2_main.show 报错，SyntaxError: invalid syntax
    ```
  </details>

> import

- 导入：`import <package>`
  
  使用：`<package>.<module>.<class/function/variable>`

  <details>
  <summary>详情例子</summary>
  
  - `main.py`
    ```python
    import src.mod1 as mod1

    # mod1.mod1_main.call()   # 报错，AttributeError: module 'src.mod1' has no attribute 'mod1_main'
    ```
  </details>

- 导入：`import <module>.<class/function/variable>`
  
  使用：`<module>.<class/function/variable>`

  <details>
  <summary>详情例子</summary>
  
  - `main.py`
    ```python
    # import src.mod2.mod2_main.show as show 报错，ModuleNotFoundError: No module named 'src.mod2.mod2_main.show'; 'src.mod2.mod2_main' is not a package
    ```
  </details>


### 1.2.2. 模块化的方法

```bash
topLevel
└── project
    ├── main.py
    ├── src
    │   ├── mod1
    │   │   └── mod1_main.py
    │   └── mod2
    │       └── mod2_main.py
    ├── mytest
    │   └── a.py
    └── data
        └── deepwater.jpg

建立一个顶级目录
```

```bash
# 这时候执行路径，必须是项目根目录的父目录下
topLevel$ python -m project.main
topLevel$ python -m project.mytest.a
```

  <details>
  <summary>详情例子</summary>
  
  - `main.py`
    ```python
    from project.src.mod1.mod1_main import call

    call()
    ```
  - `mod1_main.py`
    ```python
    from project.src.mod2.mod2_main import show
    # from ..mod2.mod2_main import show

    def call():
        show()
    ```
  - `mod2_main.py`
    ```python
    from PIL import Image
    import os

    def show():
        # 图片的引入
        BASE_DIR = os.path.abspath(os.path.join(__file__, '..', '..', '..'))
        img_path = os.path.join(BASE_DIR, r'data\deepwater.jpg')

        img = Image.open(img_path)
        img.show()
    ```

  - `a.py`
    ```python
    from .. import main

    main()
    ```
  </details>
